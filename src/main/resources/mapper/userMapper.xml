<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace 는 반드시 mapper 의 위치로 설정해야 된다 -->
<mapper namespace="com.ict.finalpj.domain.user.mapper.UserMapper">

    <select id="getUserInfoById" parameterType="String" resultType="UserVO" >
        select * from pjuser where userId = #{userId}
    </select>
    
    <insert id="insertUserInfo" parameterType="UserVO" >
        insert into pjuser (userId, userPw, userName, userNickname, userMail, 
        userPhone, userAddr, userReg)
        values (#{userId}, #{userPw}, #{userName}, #{userNickname}, #{userMail}, 
        #{userPhone}, userAddr, DATE(NOW()))
    </insert>

    <select id="getUserInfoByPhone" parameterType="String" resultType="UserVO" >
        select * from pjuser where userPhone = #{userPhone}
    </select>

    <select id="getUserInfoByNickname" parameterType="String" resultType="UserVO" >
        select * from pjuser where userNickname = #{userNickname}
    </select>

    <select id="findUserId" parameterType="UserVO" resultType="UserVO" >
        select * from pjuser where userId = #{userId} and userMail = #{userMail}
    </select>

    <select id="findUserPw" parameterType="UserVO" resultType="UserVO" >
        select * from pjuser where userName = #{userName} and userId = #{userId}
         and userMail = #{userMail} and userPhone = #{userPhone}
    </select>

    <update id="changeUserPw" parameterType="UserVO">
        update pjuser set userPw = #{userPw} 
        where userIdx = #{userIdx}
    </update>





    <select id="findUserByProvider" parameterType="UserVO" resultType="UserVO" >
        select * from members 
        where 
        (
            (sns_provider = 'kakao' and sns_email_kakao = #{sns_email_kakao})
            or
            (sns_provider = 'naver' and sns_email_kakao = #{sns_email_naver})
        )
    </select>

    <insert id="insertUser" parameterType="UserVO" >
        insert into members (
            m_id, 
            <if test="m_pw != null">
            m_pw, 
            </if>
            m_name, 
            m_age, 
            m_reg, 
            sns_email_kakao, 
            sns_email_naver, 
            sns_provider)
        values (
            #{m_id}, 
            <if test="m_pw != null">
            #{m_pw}, 
            </if>
            #{m_name}, 
            #{m_age}, 
            DATE(NOW()), 
            #{sns_email_kakao}, 
            #{sns_email_naver}, 
            #{sns_provider})
    </insert>
    
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace는 반드시 mapper 위치로 설정해야 된다. -->
<mapper namespace="com.ict.finalpj.domain.deal.mapper.DealMapper">
  <select id="getDealMainList" resultType="DealVO">
    select * from pjdeal order by dealIdx asc
  </select>

  <select id="getDealDetail" parameterType="String" resultType="DealVO">
    SELECT 
        d.*,
        GROUP_CONCAT(f.fileName ORDER BY f.fileOrder) as fileNames,
        GROUP_CONCAT(f.fileOrder ORDER BY f.fileOrder) as fileOrders
    FROM pjdeal d
    LEFT JOIN pjfile f ON d.dealIdx = f.fileTableIdx AND f.fileTableType = '2'
    WHERE d.dealIdx = #{dealIdx}
    GROUP BY d.dealIdx
  </select>

  <select id="getDealFileList" parameterType="String" resultType="FileVo">
    select * from pjfile
    where fileTableIdx = #{dealIdx}
  </select>

  <update id="getDealUpdate" parameterType="DealVO">
    update pjdeal 
    set dealTitle = #{dealTitle}, 
        dealCategory = #{dealCategory}, 
        dealStatus = #{dealStatus}, 
        dealDescription = #{dealDescription}, 
        dealPrice = #{dealPrice}, 
        dealPackage = #{dealPackage}, 
        dealDirect = #{dealDirect},
        dealDirectContent = #{dealDirectContent},
        dealCount = #{dealCount} 
    where dealIdx = #{dealIdx}
  </update>

  <insert id="getDealWrite" parameterType="DealVO">
    INSERT INTO pjdeal (dealIdx, dealTitle, dealCategory, dealStatus, dealDescription, dealPrice, dealPackage, dealDirect, dealDirectContent, dealCount, dealRegDate)
    VALUES (#{dealIdx},#{dealTitle},#{dealCategory},#{dealStatus},#{dealDescription},#{dealPrice},#{dealPackage},#{dealDirect},#{dealDirectContent},#{dealCount},NOW())
  </insert>

  <insert id="insertFileInfo" parameterType="FileVo">
    INSERT INTO pjfile (fileTableType, fileTableIdx, fileName, fileOrder, fileCreated) 
    VALUES (2, #{fileTableIdx}, #{fileName}, #{fileOrder}, NOW())
  </insert> 

  <select id="getPjFileByDealIdx" parameterType="String" resultType="FileVo">
    select * from pjfile where fileTableIdx = #{dealIdx}
  </select>

</mapper>